<!DOCTYPE html>
<html>
<head>
    <title>Vaccination Rate Bar Chart</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <style>
        .tooltip {
            position: absolute;
            text-align: center;
            width: 150px;
            height: auto;
            padding: 2px;
            font: 12px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
        }
        .chart-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        .button {
            margin: 5px;
            padding: 5px;
            background-color: #ddd;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #ccc;
        }


        .chart-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }


    </style>
</head>
<body>

<!-- Responsive navbar-->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-5">
        <a class="navbar-brand" href="index.html">Covid Data</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link active" aria-current="page" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="map.html">Map of Germany</a></li>
                <li class="nav-item"><a class="nav-link" href="city_map.html">German Cities</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="chart-title">Vaccination Rates per State</div>
<button class="button" onclick="sortAscending()">Sort Ascending</button>
<button class="button" onclick="sortDescending()">Sort Descending</button>
<input type="color" id="colorPicker" oninput="changeBarColor(this.value)">
<div class="chart-container">
    <div id="bar-chart"></div>
</div>

<script>
    // Vaccination data
    const data = [
        {"Bundesland": "Baden-Württemberg", "VaccinationRate": 67.8, "Population": 11280275},
        {"Bundesland": "Bayern", "VaccinationRate": 76.0, "Population": 13370400},
        {"Bundesland": "Berlin", "VaccinationRate": 70.0, "Population": 3755251},
        {"Bundesland": "Brandenburg", "VaccinationRate": 57.8, "Population": 2575135},
        {"Bundesland": "Bremen", "VaccinationRate": 43.7, "Population": 671489},
        {"Bundesland": "Hamburg", "VaccinationRate": 93.8, "Population": 1787408},
        {"Bundesland": "Hessen", "VaccinationRate": 63.4, "Population": 6176172},
        {"Bundesland": "Mecklenburg-Vorpommern", "VaccinationRate": 56.4, "Population": 1612362},
        {"Bundesland": "Niedersachsen", "VaccinationRate": 80.6, "Population": 7926599},
        {"Bundesland": "Nordrhein-Westfalen", "VaccinationRate": 63.3, "Population": 17865516},
        {"Bundesland": "Rheinland-Pfalz", "VaccinationRate": 87.9, "Population": 4052803},
        {"Bundesland": "Saarland", "VaccinationRate": 36.8, "Population": 995597},
        {"Bundesland": "Sachsen", "VaccinationRate": 27.5, "Population": 4084851},
        {"Bundesland": "Sachsen-Anhalt", "VaccinationRate": 18.9, "Population": 2245470},
        {"Bundesland": "Schleswig-Holstein", "VaccinationRate": 73.4, "Population": 2858714},
        {"Bundesland": "Thüringen", "VaccinationRate": 51.9, "Population": 2170714}
    ];

    // Set the dimensions and margins of the graph
    const margin = {top: 30, right: 30, bottom: 100, left: 60},
        width = 1000 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    // Create the tooltip event binding function
    function bindTooltipEvents() {
        svg.selectAll(".bar")
            .on("mouseover", function(event, d) {
                tooltip.transition().duration(200).style("opacity", .9);
                tooltip.html(`State: ${d.Bundesland}<br>Rate: ${d.VaccinationRate}%`)
                    .style("left", (event.pageX) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                tooltip.transition().duration(500).style("opacity", 0);
            });
    }

    // Append the svg object to the div called 'bar-chart'
    const svg = d3.select("#bar-chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    // X and Y axes setup
    const x = d3.scaleBand()
        .range([0, width])
        .domain(data.map(d => d.Bundesland))
        .padding(0.2);
    const xAxis = svg.append("g")
        .attr("transform", `translate(0, ${height})`)
        .call(d3.axisBottom(x))
        .selectAll("text")
        .attr("transform", "translate(-10,0)rotate(-45)")
        .style("text-anchor", "end");

    const y = d3.scaleLinear()
        .domain([0, 100])
        .range([height, 0]);
    svg.append("g")
        .call(d3.axisLeft(y));

    // Append the y-axis title
    svg.append("text")
        .attr("class", "y-axis-title")
        .attr("transform", "rotate(-90)")
        .attr("y", 0 - margin.left) // Adjust the position as needed
        .attr("x", 0 - (height / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Vaccination Rate %");


    // Create the tooltip before bars
    const tooltip = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

    // Bars setup with animation
    // Bars setup with animation
    const bars = svg.selectAll("rect")
        .data(data)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("x", d => x(d.Bundesland))
        .attr("width", x.bandwidth())
        .attr("fill", "#453483")
        .attr("y", height)
        .attr("height", 0)
        .on("mouseover", function(event, d) {
            tooltip.transition().duration(200).style("opacity", .9);
            tooltip.html(`State: ${d.Bundesland}<br>Rate: ${d.VaccinationRate}%`)
                .style("left", (event.pageX) + "px")
                .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", function() {
            tooltip.transition().duration(500).style("opacity", 0);
        })
        .transition()
        .duration(2000)
        .attr("y", d => y(d.VaccinationRate))
        .attr("height", d => height - y(d.VaccinationRate));

    bindTooltipEvents();



    // Sorting functions
    function sortAscending() {
        data.sort((a, b) => d3.ascending(a.VaccinationRate, b.VaccinationRate));
        updateChart();
    }

    function sortDescending() {
        data.sort((a, b) => d3.descending(a.VaccinationRate, b.VaccinationRate));
        updateChart();
    }

    // Update chart function
    function updateChart() {
        x.domain(data.map(d => d.Bundesland)); // Update the domain
        xAxis.transition().duration(1000).call(d3.axisBottom(x));

        // Update the x-axis
        svg.select(".x.axis") // Correctly select the x-axis group
            .transition()
            .duration(1000)
            .call(d3.axisBottom(x))
            .selectAll("text")
            .attr("transform", "translate(-10,10)rotate(-45)")
            .style("text-anchor", "end");

        // Select and update the bars
        let updatedBars = svg.selectAll("rect").data(data);

        // Update existing bars
        updatedBars
            .transition()
            .duration(1000)
            .attr("x", d => x(d.Bundesland))
            .attr("y", d => y(d.VaccinationRate))
            .attr("height", d => height - y(d.VaccinationRate));

        // Enter new bars (if any)
        updatedBars.enter()
            .append("rect")
            .attr("x", d => x(d.Bundesland))
            .attr("width", x.bandwidth())
            .attr("fill", "#69b3a2")
            .attr("y", height)
            .attr("height", 0)
            .on("mouseover", (event, d) => {
                tooltip.transition().duration(200).style("opacity", .9);
                tooltip.html(`State: ${d.Bundesland}<br>Rate: ${d.VaccinationRate}%`)
                    .style("left", (event.pageX) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", d => {
                tooltip.transition().duration(500).style("opacity", 0);
            })
            .transition()
            .duration(800)
            .attr("y", d => y(d.VaccinationRate))
            .attr("height", d => height - y(d.VaccinationRate));

        // Apply tooltip to updated bars as well
        updatedBars
            .on("mouseover", (event, d) => {
                tooltip.transition().duration(200).style("opacity", .9);
                tooltip.html(`State: ${d.Bundesland}<br>Rate: ${d.VaccinationRate}%`)
                    .style("left", (event.pageX) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", d => {
                tooltip.transition().duration(500).style("opacity", 0);
            });

        // Remove any bars that are no longer needed
        updatedBars.exit().remove();
        bindTooltipEvents();
    }

    // Function to change bar color
    function changeBarColor(newColor) {
        svg.selectAll("rect").attr('fill', newColor);
    }


</script>
</body>
</html>

